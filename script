local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local COLORS = {
    Panel = Color3.fromRGB(45, 45, 60),
    Button = Color3.fromRGB(70, 70, 90),
    ButtonHover = Color3.fromRGB(100, 100, 140),
    Text = Color3.fromRGB(220, 220, 230),
    Accent = Color3.fromRGB(120, 150, 240),
}

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SimpleMenuGui"
screenGui.Parent = playerGui

local menuFrame = Instance.new("Frame")
menuFrame.Size = UDim2.new(0, 280, 0, 360)
menuFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
menuFrame.AnchorPoint = Vector2.new(0.5, 0.5)
menuFrame.BackgroundColor3 = COLORS.Panel
menuFrame.BorderSizePixel = 0
menuFrame.Visible = false
menuFrame.Parent = screenGui

local function addUICorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 12)
    corner.Parent = parent
end
addUICorner(menuFrame)

-- Для перетаскивания меню за фон (menuFrame)
local dragging, dragInput, dragStart, startPos = false, nil, nil, nil
menuFrame.Active = true
menuFrame.Selectable = true
menuFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = menuFrame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

menuFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        menuFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- Заголовок
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -20, 0, 40)
titleLabel.Position = UDim2.new(0, 10, 0, 10)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Simple Roblox Menu"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 24
titleLabel.TextColor3 = COLORS.Accent
titleLabel.Parent = menuFrame

-- Контейнер для кнопок
local buttonsContainer = Instance.new("Frame")
buttonsContainer.Size = UDim2.new(1, -20, 1, -70)
buttonsContainer.Position = UDim2.new(0, 10, 0, 60)
buttonsContainer.BackgroundTransparency = 1
buttonsContainer.Parent = menuFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = buttonsContainer
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 10)
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- Создание кнопки с эффектом наведения
local function createButton(text, layoutOrder)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 40)
    btn.BackgroundColor3 = COLORS.Button
    btn.BorderSizePixel = 0
    btn.TextColor3 = COLORS.Text
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 18
    btn.Text = text
    btn.AutoButtonColor = false
    btn.LayoutOrder = layoutOrder
    addUICorner(btn)

    btn.MouseEnter:Connect(function()
        btn.BackgroundColor3 = COLORS.ButtonHover
    end)
    btn.MouseLeave:Connect(function()
        btn.BackgroundColor3 = COLORS.Button
    end)

    btn.Parent = buttonsContainer
    return btn
end

-- Состояния
local states = {
    infJump = false,
    noclip = false,
    speedHack = false,
    esp = false,
    homePosition = nil,
    homeBtnVisible = false,
}

local buttons = {}

local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

local function getHumanoid()
    local char = getCharacter()
    return char:WaitForChild("Humanoid")
end

-- Функции кнопок

local function toggleInfJump()
    states.infJump = not states.infJump
    buttons.infJump.Text = "Inf Jump: " .. (states.infJump and "ON" or "OFF")
end

local function toggleNoclip()
    states.noclip = not states.noclip
    buttons.noclip.Text = "Noclip: " .. (states.noclip and "ON" or "OFF")
end

local SPEED_VALUE = 50
local function toggleSpeedHack()
    states.speedHack = not states.speedHack
    local humanoid = getHumanoid()
    if states.speedHack then
        humanoid.WalkSpeed = SPEED_VALUE
    else
        humanoid.WalkSpeed = 16
    end
    buttons.speedHack.Text = "Speed Hack (50): " .. (states.speedHack and "ON" or "OFF")
end

local function setHome()
    local char = getCharacter()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp then
        states.homePosition = hrp.CFrame
        buttons.setHome.Text = "Set Home: ✔"
        if not states.homeBtnVisible then
            states.homeBtnVisible = true
            homeButton.Visible = true
        end
    end
end

local function tpHome()
    if not states.homePosition then return end
    local char = getCharacter()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp then
        local originalPos = hrp.CFrame
        hrp.CFrame = states.homePosition
        wait(0.05)
        hrp.CFrame = originalPos
    end
end

-- ESP (простые имена игроков)

local espLabels = {}

local function createESPForPlayer(plr)
    if plr == player then return end
    local char = plr.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = hrp
    billboard.Size = UDim2.new(0, 100, 0, 30)
    billboard.AlwaysOnTop = true
    billboard.Parent = screenGui

    local label = Instance.new("TextLabel", billboard)
    label.BackgroundTransparency = 0.6
    label.BackgroundColor3 = Color3.new(0, 0, 0)
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Size = UDim2.new(1, 0, 1, 0)
    label.Text = plr.Name
    label.Font = Enum.Font.GothamBold
    label.TextScaled = true

    espLabels[plr] = billboard
end

local function removeESPForPlayer(plr)
    if espLabels[plr] then
        espLabels[plr]:Destroy()
        espLabels[plr] = nil
    end
end

local function toggleESP()
    states.esp = not states.esp
    buttons.esp.Text = "ESP: " .. (states.esp and "ON" or "OFF")
    if states.esp then
        for _, plr in pairs(Players:GetPlayers()) do
            createESPForPlayer(plr)
        end
    else
        for plr, _ in pairs(espLabels) do
            removeESPForPlayer(plr)
        end
    end
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        wait(1)
        if states.esp then
            createESPForPlayer(plr)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(plr)
    removeESPForPlayer(plr)
end)

-- Создаем кнопки

buttons.infJump = createButton("Inf Jump: OFF", 1)
buttons.infJump.MouseButton1Click:Connect(toggleInfJump)

buttons.noclip = createButton("Noclip: OFF", 2)
buttons.noclip.MouseButton1Click:Connect(toggleNoclip)

buttons.speedHack = createButton("Speed Hack (50): OFF", 3)
buttons.speedHack.MouseButton1Click:Connect(toggleSpeedHack)

buttons.setHome = createButton("Set Home", 4)
buttons.setHome.MouseButton1Click:Connect(setHome)

buttons.tpHome = createButton("TP Home", 5)
buttons.tpHome.MouseButton1Click:Connect(tpHome)

buttons.esp = createButton("ESP: OFF", 6)
buttons.esp.MouseButton1Click:Connect(toggleESP)

-- Кнопка вызова меню
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 60, 0, 60)
toggleBtn.Position = UDim2.new(0, 20, 0, 20)
toggleBtn.BackgroundColor3 = COLORS.Accent
toggleBtn.BorderSizePixel = 0
toggleBtn.Text = "Menu"
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 18
toggleBtn.AutoButtonColor = false
toggleBtn.Parent = screenGui
addUICorner(toggleBtn, 15)

toggleBtn.MouseEnter:Connect(function()
    toggleBtn.BackgroundColor3 = COLORS.ButtonHover
end)
toggleBtn.MouseLeave:Connect(function()
    toggleBtn.BackgroundColor3 = COLORS.Accent
end)

local menuOpen = false
toggleBtn.MouseButton1Click:Connect(function()
    menuOpen = not menuOpen
    menuFrame.Visible = menuOpen
end)

-- Маленькая кнопка "Home"
local homeButton = Instance.new("TextButton")
homeButton.Size = UDim2.new(0, 50, 0, 50)
homeButton.Position = UDim2.new(0, 100, 0, 20)
homeButton.BackgroundColor3 = COLORS.Accent
homeButton.BorderSizePixel = 0
homeButton.Text = "Home"
homeButton.TextColor3 = Color3.new(1,1,1)
homeButton.Font = Enum.Font.GothamBold
homeButton.TextSize = 14
homeButton.Visible = false
homeButton.AutoButtonColor = false
homeButton.Parent = screenGui
addUICorner(homeButton, 12)

-- Перетаскивание кнопки "Home"
local homeDragging, homeDragInput, homeDragStart, homeStartPos = false, nil, nil, nil
homeButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        homeDragging = true
        homeDragStart = input.Position
        homeStartPos = homeButton.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                homeDragging = false
            end
        end)
    end
end)
homeButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        homeDragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == homeDragInput and homeDragging then
        local delta = input.Position - homeDragStart
        homeButton.Position = UDim2.new(
            homeStartPos.X.Scale,
            homeStartPos.X.Offset + delta.X,
            homeStartPos.Y.Scale,
            homeStartPos.Y.Offset + delta.Y
        )
    end
end)

homeButton.MouseButton1Click:Connect(function()
    if not states.homePosition then return end
    local char = getCharacter()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp then
        local originalPos = hrp.CFrame
        hrp.CFrame = states.homePosition
        wait(0.05)
        hrp.CFrame = originalPos
    end
end)

-- Inf Jump обработка
UserInputService.JumpRequest:Connect(function()
    if states.infJump then
        local humanoid = getHumanoid()
        if humanoid then
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- Noclip обработка
RunService.Stepped:Connect(function()
    local char = getCharacter()
    if states.noclip and char then
        for _, part in pairs(char:GetChildren()) do
            if part:IsA("BasePart") and part.CanCollide then
                part.CanCollide = false
            end
        end
    elseif char then
        for _, part in pairs(char:GetChildren()) do
            if part:IsA("BasePart") and not part.CanCollide then
                part.CanCollide = true
            end
        end
    end
end)

-- Сброс скорости при респавне
player.CharacterAdded:Connect(function(char)
    wait(1)
    if states.speedHack then
        local humanoid = char:WaitForChild("Humanoid")
        humanoid.WalkSpeed = SPEED_VALUE
    end
end)
